<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; }
    body { 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      background: #1a1a1f; 
      color: #fafafa;
      display: flex;
      flex-direction: column;
      user-select: none;
    }
    
    /* Titlebar */
    .titlebar {
      height: 32px;
      background: #0f0f12;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #27272a;
      -webkit-app-region: drag;
      flex-shrink: 0;
    }
    
    .titlebar-left {
      display: flex;
      align-items: center;
      gap: 8px;
      padding-left: 12px;
    }
    
    .titlebar-icon {
      width: 16px;
      height: 16px;
      fill: none;
      stroke: #22d3ee;
      stroke-width: 2;
    }
    
    .titlebar-title {
      font-size: 12px;
      color: #a1a1aa;
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .window-controls {
      display: flex;
      -webkit-app-region: no-drag;
    }
    
    .win-btn {
      width: 46px;
      height: 32px;
      border: none;
      background: transparent;
      color: #71717a;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.1s, color 0.1s;
    }
    
    .win-btn:hover { background: #27272a; color: #fff; }
    .win-btn.close:hover { background: #dc2626; }
    .win-btn svg { width: 12px; height: 12px; stroke: currentColor; fill: none; stroke-width: 2; }
    
    /* Toolbar */
    .toolbar {
      height: 48px;
      background: #18181b;
      display: flex;
      align-items: center;
      padding: 0 8px;
      gap: 4px;
      flex-shrink: 0;
    }
    
    .nav-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      color: #71717a;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.1s, color 0.1s;
      flex-shrink: 0;
    }
    
    .nav-btn:hover:not(:disabled) { background: #27272a; color: #fafafa; }
    .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .nav-btn svg { width: 16px; height: 16px; stroke: currentColor; fill: none; stroke-width: 2; }
    
    /* URL Bar */
    .url-container {
      flex: 1;
      display: flex;
      align-items: center;
      min-width: 0;
      margin: 0 4px;
    }
    
    .url-box {
      flex: 1;
      height: 32px;
      display: flex;
      align-items: center;
      background: #27272a;
      border: 1px solid #3f3f46;
      border-radius: 8px;
      padding: 0 10px;
      gap: 8px;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    
    .url-box:focus-within { 
      border-color: #22d3ee; 
      box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.15);
    }
    
    .url-box .icon { 
      width: 14px; 
      height: 14px; 
      stroke: #52525b; 
      fill: none; 
      stroke-width: 2; 
      flex-shrink: 0; 
    }
    
    .url-box.secure .icon { stroke: #22c55e; }
    
    .url-input {
      flex: 1;
      background: none;
      border: none;
      color: #fafafa;
      font-size: 13px;
      outline: none;
      min-width: 0;
    }
    
    .url-input::placeholder { color: #52525b; }
    .url-input::selection { background: rgba(34, 211, 238, 0.3); }
    
    /* Loading indicator */
    .loading-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 2px;
      background: linear-gradient(90deg, #22d3ee, #a855f7, #22d3ee);
      background-size: 200% 100%;
      width: 0%;
      transition: width 0.3s;
      animation: shimmer 1.5s infinite linear;
    }
    
    .loading-bar.active { width: 100%; }
    
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
  </style>
</head>
<body>
  <div class="titlebar">
    <div class="titlebar-left">
      <svg class="titlebar-icon" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10"/>
        <line x1="2" y1="12" x2="22" y2="12"/>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
      </svg>
      <span class="titlebar-title" id="pageTitle">Poly Browser</span>
    </div>
    <div class="window-controls">
      <button class="win-btn" onclick="window.ipc.postMessage('minimize')" title="Minimize">
        <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
      <button class="win-btn" onclick="window.ipc.postMessage('maximize')" title="Maximize">
        <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
      </button>
      <button class="win-btn close" onclick="window.ipc.postMessage('close')" title="Close">
        <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
  </div>
  
  <div class="toolbar">
    <button class="nav-btn" id="backBtn" onclick="goBack()" title="Back">
      <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <button class="nav-btn" id="forwardBtn" onclick="goForward()" title="Forward">
      <svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>
    </button>
    <button class="nav-btn" id="reloadBtn" onclick="reload()" title="Reload">
      <svg viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
    </button>
    
    <div class="url-container">
      <div class="url-box" id="urlBox">
        <svg class="icon" viewBox="0 0 24 24" id="securityIcon">
          <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text" class="url-input" id="urlInput" 
               placeholder="Search or enter URL" 
               spellcheck="false"
               autocomplete="off">
      </div>
    </div>
    
    <button class="nav-btn" onclick="goHome()" title="Home">
      <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    </button>
    
    <div class="loading-bar" id="loadingBar"></div>
  </div>

  <script>
    const urlInput = document.getElementById('urlInput');
    const urlBox = document.getElementById('urlBox');
    const securityIcon = document.getElementById('securityIcon');
    const pageTitle = document.getElementById('pageTitle');
    const loadingBar = document.getElementById('loadingBar');
    
    let currentUrl = 'https://google.com';
    let isLoading = false;
    
    // Event handlers called from native
    window.onNavStart = function(url) {
      console.log('Nav started:', url);
      currentUrl = url;
      urlInput.value = url;
      updateSecurityIcon(url);
      setLoading(true);
    };
    
    window.onLoadEnd = function(url) {
      console.log('Load ended:', url);
      setLoading(false);
    };
    
    window.onTitleChange = function(title) {
      console.log('Title changed:', title);
      pageTitle.textContent = title || 'Poly Browser';
    };
    
    // Navigate to URL
    function navigate(url) {
      if (!url || url.trim() === '') return;
      
      url = url.trim();
      
      // Check if it's a search query or URL
      if (!url.includes('.') && !url.startsWith('http') && !url.startsWith('file:')) {
        // It's a search query - use Google
        url = 'https://www.google.com/search?q=' + encodeURIComponent(url);
      } else if (!url.startsWith('http://') && !url.startsWith('https://') && !url.startsWith('file:')) {
        // Add https:// prefix
        url = 'https://' + url;
      }
      
      currentUrl = url;
      urlInput.value = url;
      updateSecurityIcon(url);
      setLoading(true);
      
      window.ipc.postMessage('navigate:' + url);
    }
    
    // Handle Enter key in URL input
    urlInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        navigate(urlInput.value);
        urlInput.blur();
      } else if (e.key === 'Escape') {
        urlInput.value = currentUrl;
        urlInput.blur();
      }
    });
    
    // Select all on focus
    urlInput.addEventListener('focus', function() {
      setTimeout(() => urlInput.select(), 0);
    });
    
    // Navigation functions
    function goBack() {
      window.ipc.postMessage('navigate:javascript:history.back()');
    }
    
    function goForward() {
      window.ipc.postMessage('navigate:javascript:history.forward()');
    }
    
    function reload() {
      setLoading(true);
      navigate(currentUrl);
    }
    
    function goHome() {
      navigate('https://google.com');
    }
    
    // Update security icon based on URL
    function updateSecurityIcon(url) {
      if (url.startsWith('https://')) {
        urlBox.classList.add('secure');
        securityIcon.innerHTML = '<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>';
      } else {
        urlBox.classList.remove('secure');
        securityIcon.innerHTML = '<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>';
      }
    }
    
    // Loading state
    function setLoading(loading) {
      isLoading = loading;
      if (loading) {
        loadingBar.classList.add('active');
      } else {
        loadingBar.classList.remove('active');
      }
    }
    
    // Initialize
    urlInput.value = currentUrl;
    updateSecurityIcon(currentUrl);
  </script>
</body>
</html>
